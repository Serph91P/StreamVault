@use 'sass:map';
@use 'sass:color';
@use 'variables' as v;
@use 'mixins' as m;
@forward 'variables';
@use 'glass';  // Phase 3: Glassmorphism system
@use 'animations';
@use 'layout';
@use 'components';
@use 'views';
@use 'utilities';  // NEW: Design system utilities
@use 'tables';  // NEW: Unified table system
@use 'settings-panels';  // NEW: Unified settings panels design

// Import FontAwesome
@import '@fortawesome/fontawesome-free/css/all.css';

// CSS Reset und moderne Basis
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

:root {
  font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  font-size: 16px;
  color-scheme: dark;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  scroll-behavior: smooth;
  
  // Smooth theme transition for all color properties
  transition: 
    background-color 300ms var(--vue-ease-out),
    color 300ms var(--vue-ease-out),
    border-color 300ms var(--vue-ease-out);
}

// Light mode color scheme
[data-theme="light"] {
  color-scheme: light;
}

// Apply smooth transitions to all elements during theme change
* {
  transition: 
    background-color 300ms var(--vue-ease-out),
    color 300ms var(--vue-ease-out),
    border-color 300ms var(--vue-ease-out);
}

/* Core fixes mit besserer Mobiloptimierung */
html, body {
  overflow-x: hidden;
  width: 100%;
  height: 100%;
  -webkit-overflow-scrolling: touch;
}

body {
  background: var(--background-dark);  /* CRITICAL: Use CSS custom property for theme switching */
  color: var(--text-primary);          /* CRITICAL: Use CSS custom property for theme switching */
  min-height: 100vh;
  line-height: 1.6;
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow-x: hidden; // Prevent horizontal scroll
}

// Ensure all view containers fill available width
.page-view,
.content-view,
.home-view,
.videos-view,
.streamers-view,
.settings-view,
.add-streamer-view,
.streamer-detail-view,
.subscriptions-view,
.admin-view {
  width: 100% !important;
  max-width: 100% !important;
  min-width: 0 !important;
}

// Bessere Fokus-Stile 
:focus {
  @include m.focus-outline;
}

// Typografie-Hierarchie
h1, h2, h3, h4, h5, h6 {
  line-height: 1.2;
  font-weight: 600;
  margin-bottom: 0.5em;
  
  &:first-child {
    margin-top: 0;
  }
}

h1 { font-size: map.get(v.$font-scale, '2xl'); }
h2 { font-size: map.get(v.$font-scale, 'xl'); }
h3 { font-size: map.get(v.$font-scale, 'lg'); }
h4 { font-size: map.get(v.$font-scale, 'base'); }
h5, h6 { font-size: map.get(v.$font-scale, 'sm'); }

// Form Elements - iOS Zoom Prevention & Consistent Styling
// CRITICAL: Font-size >= 16px prevents iOS Safari from zooming on focus
input:not([type="checkbox"]):not([type="radio"]),
select,
textarea {
  // Base styles
  font-family: inherit;
  color: var(--text-primary);
  background: var(--background-card);
  border: 1px solid var(--border-color);
  border-radius: v.$border-radius;
  padding: v.$spacing-sm v.$spacing-md;
  transition: border-color v.$transition-fast, box-shadow v.$transition-fast;
  width: 100%;
  
  // iOS zoom prevention on mobile (font-size must be >= 16px)
  // See: https://webkit.org/blog/3810/stop-emails-from-zooming-on-mobile-safari/
  @include m.respond-below('md') {  // < 768px (mobile/tablet)
    font-size: 16px !important;  // CRITICAL: Prevents iOS zoom on focus
  }
  
  // Desktop: Use design system font size
  @include m.respond-to('md') {  // >= 768px (desktop)
    font-size: map.get(v.$font-scale, 'base');
  }
  
  // Interaction states
  &:hover {
    border-color: var(--primary-color);
  }
  
  &:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.1);
  }
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    background: var(--background-darker);
  }
  
  &::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
  }
}

// Buttons - Touch Targets & Consistent Styling
button:not(.unstyled),
.btn {
  font-family: inherit;
  font-weight: 500;  // Medium weight
  border-radius: v.$border-radius-lg;
  cursor: pointer;
  transition: all v.$transition-fast;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: v.$spacing-2;
  
  // Icon sizing inside buttons
  svg, .icon {
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    fill: none;
    stroke: currentColor;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  
  // Touch targets on mobile (Apple HIG: 44x44px minimum)
  @include m.respond-below('md') {  // < 768px
    min-height: 44px;
    padding: v.$spacing-sm v.$spacing-md;
  }
  
  // Desktop
  @include m.respond-to('md') {  // >= 768px
    min-height: 36px;
    padding: calc(v.$spacing-sm - 2px) v.$spacing-md;
  }
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  &:not(:disabled):hover {
    transform: translateY(-1px);
    box-shadow: v.$shadow-md;
  }
  
  &:not(:disabled):active {
    transform: translateY(0);
  }
}

// ============================================================================
// BUTTON VARIANTS - Global Design System
// ============================================================================

// Primary button (teal)
.btn-primary {
  background: var(--primary-color);
  color: white;
  border: 1px solid var(--primary-color);

  &:not(:disabled):hover {
    background: var(--primary-color-dark);
    border-color: var(--primary-color-dark);
  }

  &:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
  }
  
  // Light mode: Ensure readable text
  [data-theme="light"] & {
    color: white;  // Always white text on teal button
    background: v.$primary-600;  // Slightly darker for better contrast
    border-color: v.$primary-600;
    
    &:not(:disabled):hover {
      background: v.$primary-700;
      border-color: v.$primary-700;
    }
  }
}

// Secondary button (neutral)
.btn-secondary {
  background: var(--background-darker);
  color: var(--text-primary);
  border: 1px solid var(--border-color);

  &:not(:disabled):hover {
    background: var(--background-card);
    border-color: var(--primary-color);
  }
  
  // Light mode: Better contrast
  [data-theme="light"] & {
    background: v.$slate-200;
    color: v.$slate-900;
    border-color: v.$slate-300;
    
    &:not(:disabled):hover {
      background: v.$slate-300;
      border-color: v.$primary-500;
      color: v.$primary-700;
    }
  }
}

// Accent button (purple)
.btn-accent {
  background: var(--accent-color);
  color: white;
  border: 1px solid var(--accent-color);

  &:not(:disabled):hover {
    background: v.$accent-600;
    border-color: v.$accent-600;
  }
}

// Danger button (red)
.btn-danger {
  background: var(--danger-color);
  color: white;
  border: 1px solid var(--danger-color);

  &:not(:disabled):hover {
    background: v.$danger-600;
    border-color: v.$danger-600;
  }

  &:focus-visible {
    outline: 2px solid var(--danger-color);
    outline-offset: 2px;
  }
  
  // Light mode: Ensure white text on red
  [data-theme="light"] & {
    color: white;  // Always white text on red button
    background: v.$danger-600;
    border-color: v.$danger-600;
    
    &:not(:disabled):hover {
      background: v.$danger-700;
      border-color: v.$danger-700;
    }
  }
}

// Success button (green)
.btn-success {
  background: var(--success-color);
  color: white;
  border: 1px solid var(--success-color);

  &:not(:disabled):hover {
    background: v.$success-600;
    border-color: v.$success-600;
  }
  
  // Light mode: Ensure white text on green
  [data-theme="light"] & {
    color: white;
    background: v.$success-600;
    border-color: v.$success-600;
    
    &:not(:disabled):hover {
      background: v.$success-700;
      border-color: v.$success-700;
    }
  }
}

// Warning button (orange/yellow)
.btn-warning {
  background: var(--warning-color);
  color: v.$slate-800;  // Dark text for contrast
  border: 1px solid var(--warning-color);

  &:not(:disabled):hover {
    background: v.$warning-600;
    border-color: v.$warning-600;
    color: white;
  }
}

// Info button (blue)
.btn-info {
  background: var(--info-color);
  color: white;
  border: 1px solid var(--info-color);

  &:not(:disabled):hover {
    background: v.$info-600;
    border-color: v.$info-600;
  }
}

// Ghost/Outline buttons (transparent with border)
.btn-ghost,
.btn-outline {
  background: transparent;
  border: 1px solid var(--border-color);
  color: var(--text-primary);

  &:not(:disabled):hover {
    background: var(--background-card);
    border-color: var(--primary-color);
    color: var(--primary-color);
  }
}

.btn-outline-primary {
  background: transparent;
  border: 1px solid var(--primary-color);
  color: var(--primary-color);

  &:not(:disabled):hover {
    background: var(--primary-color);
    color: white;
  }
}

.btn-outline-danger {
  background: transparent;
  border: 1px solid var(--danger-color);
  color: var(--danger-color);

  &:not(:disabled):hover {
    background: var(--danger-color);
    color: white;
  }
}

// Text buttons (no background, no border)
.btn-text {
  background: transparent;
  border: none;
  color: var(--primary-color);
  padding: v.$spacing-sm;

  &:not(:disabled):hover {
    background: rgba(var(--primary-color-rgb), 0.1);
    transform: none;  // No lift effect
    box-shadow: none;
  }
}

// Icon-only buttons (square, centered icon)
.btn-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: v.$spacing-sm;
  min-width: 40px;
  
  @include m.respond-below('md') {
    min-width: 44px;  // Touch target
    min-height: 44px;
  }
  
  // SVG icon styling inside buttons - handles both fill and stroke icons
  svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    
    // For fill-based icons
    &.icon-fill {
      fill: currentColor;
    }
    
    // For stroke-based icons (Lucide/Feather style)
    &.icon-stroke,
    &:not(.icon-fill) {
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
  }
}

// Button sizes
.btn-sm {
  padding: v.$spacing-xs v.$spacing-sm;
  font-size: v.$text-sm;
  min-height: 32px;
  
  @include m.respond-below('md') {
    min-height: 40px;  // Still touch-friendly
  }
}

.btn-lg {
  padding: v.$spacing-md v.$spacing-lg;
  font-size: v.$text-lg;
  min-height: 48px;
  
  @include m.respond-below('md') {
    min-height: 52px;
  }
}

// Button with icon + text
.btn-with-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: v.$spacing-2;  // 8px between icon and text
  
  // SVG icons inside buttons
  svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }
  
  // Stroke-based icons (Lucide/Feather style)
  .icon-stroke {
    fill: none;
    stroke: currentColor;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-linejoin: round;
  }
  
  // Fill-based icons
  .icon-fill {
    fill: currentColor;
  }
}

// Full-width button (for mobile forms)
.btn-block {
  width: 100%;
  
  // When combined with btn-with-icon, use flex instead of block
  &.btn-with-icon {
    display: flex;
  }
  
  &:not(.btn-with-icon) {
    display: block;
  }
}

// Link-Styling
a {
  color: var(--primary-color);  /* Use CSS variable for theme switching */
  text-decoration: none;
  transition: color v.$transition-fast;
  
  &:hover {
    color: var(--primary-600);  /* Use CSS variable for theme switching */
  }
}

// Responsive Bild-Optimierung
img {
  max-width: 100%;
  height: auto;
  display: block;
}

// Verbesserte Vue-Übergänge
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s v.$vue-ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

// Container
.container {
  width: 100%;
  padding-inline: v.$spacing-sm;
  margin-inline: auto;
  
  @include m.respond-to('sm') {
    padding-inline: v.$spacing-md;
  }
  
  @include m.respond-to('md') {
    max-width: map.get(v.$container-sizes, 'md');
    padding-inline: v.$spacing-lg;
  }
  
  @include m.respond-to('lg') {
    max-width: map.get(v.$container-sizes, 'lg');
  }
  
  @include m.respond-to('xl') {
    max-width: map.get(v.$container-sizes, 'xl');
  }
}

// Scroll-Balken
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-darker);  /* Use CSS variable for theme switching */
}

::-webkit-scrollbar-thumb {
  background: var(--border-color);  /* Use CSS variable for theme switching */
  border-radius: 4px;
  
  &:hover {
    background: var(--border-color);  /* Use CSS variable */
    opacity: 0.8;
  }
}

// Animationen
@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.7;
  }
  20% {
    transform: scale(25, 25);
    opacity: 0.5;
  }
  100% {
    opacity: 0;
    transform: scale(40, 40);
  }
}

// Verbesserte Safe-Area-Unterstützung für notch phones
@supports (padding: max(0px)) {
  body, .mobile-nav-bottom, .main-content {
    // Use safe-area insets, with a small minimum for non-notch devices
    padding-left: max(0.25rem, env(safe-area-inset-left));
    padding-right: max(0.25rem, env(safe-area-inset-right));
  }
  
  .mobile-nav-bottom {
    padding-bottom: max(v.$spacing-xs, env(safe-area-inset-bottom));
  }
}

// Zugänglichkeit
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

// Animation Toggle - Disable all animations when user preference is set
.no-animations,
.no-animations *,
.no-animations *::before,
.no-animations *::after {
  animation-duration: 0.001ms !important;
  animation-iteration-count: 1 !important;
  transition-duration: 0.001ms !important;
  scroll-behavior: auto !important;
}
