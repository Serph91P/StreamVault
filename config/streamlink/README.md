# Streamlink Configuration Directory

This directory contains **auto-generated** Streamlink configuration files.

## ‚ö†Ô∏è DO NOT Edit Files Here Manually

All configuration files in this directory are automatically generated by StreamVault from:
- Environment variables (e.g., `TWITCH_OAUTH_TOKEN`)
- Database settings (GlobalSettings table)
- Streamer-specific preferences (StreamerRecordingSettings table)

**Manual edits will be overwritten** on:
- Application startup
- Settings changes (proxy, codecs)
- Configuration regeneration

## Auto-Generated Files

### `config.twitch`
Global Streamlink configuration for Twitch streams, containing:
- OAuth authentication header (if `TWITCH_OAUTH_TOKEN` is set)
- Supported codecs (from GlobalSettings.supported_codecs)
- Proxy settings (if configured in Settings)
- Static options (timeouts, retries, live edge, etc.)

**Generated by:** `app/services/system/streamlink_config_service.py`

## How It Works

1. **Startup:** Config generated from database + environment
2. **Recording:** Streamlink uses `--config /app/config/streamlink/config.twitch`
3. **CLI Override:** Per-recording parameters (quality, output, log path) override config
4. **Priority:** CLI parameters > config file > Streamlink defaults

## Host System Setup

When using Docker, this directory is mounted as a volume:

```yaml
volumes:
  - ./config/streamlink:/app/config/streamlink
```

**Required:** Directory must exist on host before starting container.

```bash
# Create directory on host
mkdir -p config/streamlink

# Start container (will auto-generate config.twitch)
docker compose up -d
```

## Troubleshooting

### Permission Denied Error
```
‚ùå Failed to create streamlink config directory: [Errno 13] Permission denied
```

**Solution:**
```bash
# On host system
mkdir -p config/streamlink
chmod 775 config/streamlink

# Restart container
docker compose restart app
```

### Config File Not Found
```
‚ùå Failed to write streamlink config: [Errno 2] No such file or directory
```

**Solution:**
1. Ensure `config/streamlink` exists on **host** system
2. Check volume mount in `docker-compose.yml`
3. Verify container has write permissions (user `1000:1000`)

### OAuth Token Not Applied
- Check logs for "üîë Twitch OAuth token configured"
- Verify `TWITCH_OAUTH_TOKEN` in `.env` file
- Restart container after adding token

## Configuration Sources

| Setting | Source | Example |
|---------|--------|---------|
| OAuth Token | Environment (`TWITCH_OAUTH_TOKEN`) | From browser cookies |
| Codecs | Database (`GlobalSettings.supported_codecs`) | `h265,h264` |
| Proxy | Database (`GlobalSettings.http_proxy`) | `http://user:pass@host:port` |
| Timeouts | Static (hardcoded in service) | `stream-timeout=300` |

## Related Documentation

- OAuth setup: `/docs/TWITCH_OAUTH_H265_SETUP.md`
- Service code: `/app/services/system/streamlink_config_service.py`
- Recording flow: `/docs/CRITICAL_RECORDING_ISSUES.md`

---

**Last Updated:** November 16, 2025  
**Auto-Generated:** Yes (see service code for details)
